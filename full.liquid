<style>
.card { border-radius: 12px; padding: 16px; }
.time-display { line-height: 1.0; }
.divider-subtle { border-color: rgba(255,255,255,0.06); }
.divider-footer { border-color: rgba(255,255,255,0.09); }
.spacing-xs { margin-top: 4px; }
.badge-row { display: flex; gap: 3px; flex-wrap: nowrap; }
</style>

{% assign station = root.station[0] %}
{% assign pst_offset = 3600 | times: -8 %}
{% assign now_utc = "now" | date: "%s" %}
{% assign now_pst = now_utc | plus: pst_offset %}

<div class="layout layout--col gap--small">
  <div class="header">
    <div class="title title--large text--black">{{ station.name }}</div>
    {% if bart_direction and bart_direction != "" %}
      <div class="label label--xsmall text--gray-60 spacing-xs">
        Direction: {{ bart_direction | capitalize }}
      </div>
    {% endif %}
  </div>

  <div class="grid grid--cols-3 gap--medium">
    {% assign train_count = 0 %}
    {% assign shown_trains = "" %}

    {% if station.etd %}
      <!-- Loop through all trains and show unique ones -->
      {% for etd in station.etd %}
        {% if etd.estimate %}
          {% for est in etd.estimate %}
            {% if train_count < 6 %}
              {% assign train_id = etd.abbreviation | append: "-" | append: est.minutes | append: "-" | append: est.platform | append: "-" | append: est.direction %}
              {% unless shown_trains contains train_id %}
                <div class="item bg--black card">
                  <div class="content layout--col gap--small">
                    <div class="value value--large text--gray-60" style="letter-spacing: 0.4px;">
                      {{ etd.abbreviation }}
                    </div>

                    <div class="value value--xlarge text--white time-display" style="font-size: 2.6em;">
                      {% if est.minutes == 'Leaving' or est.minutes == '0' %}
                        Now
                      {% else %}
                        {% assign arrival_seconds = est.minutes | times: 60 %}
                        {% assign arrival_timestamp = now_pst | plus: arrival_seconds %}
                        {% assign arrival_time_str = arrival_timestamp | date: "%-I:%M %p" %}
                        {{ arrival_time_str }}
                      {% endif %}
                    </div>

                    <div class="divider divider-subtle"></div>

                    <div class="badge-row">
                      <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                        <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                          PLAT {{ est.platform }}
                        </div>
                      </div>

                      {% if est.bikeflag == "1" %}
                        <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                          <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                            BIKE
                          </div>
                        </div>
                      {% else %}
                        <span class="label label--xsmall label--inverted text--gray-40">BIKE</span>
                      {% endif %}

                      {% assign delay_num = est.delay | plus: 0 %}
                      {% if est.canceled == "1" %}
                        <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                          <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                            CANCEL
                          </div>
                        </div>
                      {% elsif delay_num > 0 %}
                        <div class="bg--white" style="border-radius: 6px; padding: 8px 8px;">
                          <div style="color: #000; font-weight: bold; font-size: 14px; white-space: nowrap;">
                            DELAY
                          </div>
                        </div>
                      {% else %}
                        <span class="label label--xsmall label--inverted text--gray-40">DELAY</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                {% assign train_count = train_count | plus: 1 %}
                {% assign shown_trains = shown_trains | append: train_id | append: "|" %}
              {% endunless %}
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}

    {% if train_count == 0 %}
      <div class="item bg--black card" style="grid-column: 1 / -1;">
        <div class="content layout--col gap--small">
          <div class="value value--xlarge text--white">⚠️</div>
          <div class="label label--small text--gray-40">No trains available</div>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="footer">
    <div class="divider divider-footer"></div>
    <div class="label label--xsmall text--gray-50"></div>
    {% if last_updated %}
      <div class="label label--xsmall text--gray-60">Updated {{ last_updated }}</div>
    {% endif %}
  </div>
</div>